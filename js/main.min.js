var Debug=(()=>{function init(){settings.isLocal=-1<location.href.indexOf("local"),settings.isActive=settings.isLocal,window.addEventListener("keyup",function(event){event.keyCode!==settings.keyboardKeys.toggle&&event.which!==settings.keyboardKeys.toggle||(settings.isActive=!settings.isActive,console.log("Toggle debug mode",settings.isActive))})}var settings={isLocal:!1,isActive:!0,keyboardKeys:{toggle:68}};return{init:function(){init()},log:function(){(settings.isLocal||settings.isActive)&&console.log.apply(console,arguments)}}})(),Viewport=(Debug.init(),(()=>{function init(){Debug.log("viewport.init()"),settings.element=$(window),onResizeFinish(),settings.element.on("resize",function(){settings.resizeDelay?(clearTimeout(settings.resizeDelay),settings.resizeDelay=null):($("html").addClass("resizing"),$(document).trigger("viewport/resize/start")),settings.resizeDelay=setTimeout(function(){$("html").removeClass("resizing"),$(document).trigger("viewport/resize/finish"),settings.resizeDelay=null},500)}),"scrollEvent"==settings.scrollDetectionMode&&settings.element.on("scroll",function(){var now=Date.now(),elapsed=now-settings.nowScroll;elapsed>settings.fps&&(settings.nowScroll=now-elapsed%settings.fps,settings.scrollTop=settings.element.scrollTop(),$(document).trigger("viewport/scroll"))}),$(document).on("viewport/scroll",function(){onScroll()}).on("viewport/resize/finish",function(){onResizeFinish()}).on("viewport/scroll/toTop",function(){Debug.log("scrolled to top"),$("html").addClass("scrolled-to-top")}).on("viewport/scroll/fromTop",function(){Debug.log("scrolled from top"),$("html").removeClass("scrolled-to-top")}).on("viewport/scroll/toBottom",function(){Debug.log("scrolled to bottom"),$("html").addClass("scrolled-to-bottom")}).on("viewport/scroll/fromBottom",function(){Debug.log("scrolled from bottom"),$("html").removeClass("scrolled-to-bottom")}).on("viewport/scroll/toFirstScreen",function(){Debug.log("scrolled to first screen"),$("html").addClass("scrolled-to-first-screen")}).on("viewport/scroll/fromFirstScreen",function(){Debug.log("scrolled from first screen"),$("html").removeClass("scrolled-to-first-screen")}).on("viewport/scroll/toLastScreen",function(){Debug.log("scrolled to last screen"),$("html").addClass("scrolled-to-last-screen")}).on("viewport/scroll/fromLastScreen",function(){Debug.log("scrolled from last screen"),$("html").removeClass("scrolled-to-last-screen")}),onScroll(),onLoop()}var settings={width:0,height:0,documentHeight:0,nowLoop:Date.now(),fps:1e3/60,scrollTop:-1,_scrollTop:-1,scrollDetectionMode:"scrollEvent",nowScroll:Date.now(),scrollFactor:-1,isScrolledToTop:!1,isScrolledToBottom:!1,scrollTopOffset:20,scrollBottomOffset:20,isScrolledToFirstScreen:!1,isScrolledToLastScreen:!1,scrollToOffset:0,scrollToSpeed:2},onLoop=function(){requestAnimationFrame(onLoop);var now=Date.now(),elapsed=now-settings.nowLoop;elapsed>settings.fps&&(settings.nowLoop=now-elapsed%settings.fps,$(document).trigger("viewport/loop",[{now:now}]),"requestAnimationFrame"==settings.scrollDetectionMode)&&(settings._scrollTop=settings.scrollTop,settings.scrollTop=settings.element.scrollTop(),settings.scrollTop!=settings._scrollTop)&&$(document).trigger("viewport/scroll")},onResizeFinish=function(){Debug.log("viewport.onResizeFinish()"),settings.width=settings.element.width(),settings.height=settings.element.height(),settings.documentHeight=$("html").outerHeight()},onScroll=function(){Debug.log("viewport.onScroll()"),settings.scrollFactor=settings.scrollTop/(settings.height-settings.documentHeight)*-1,settings.scrollTop>settings.scrollTopOffset&&settings.isScrolledToTop&&(settings.isScrolledToTop=!1,$(document).trigger("viewport/scroll/fromTop")),settings.scrollTop<settings.scrollTopOffset&&(settings.isScrolledToTop||(settings.isScrolledToTop=!0,$(document).trigger("viewport/scroll/toTop"))),settings.scrollTop>settings.documentHeight-settings.height-settings.scrollBottomOffset&&(settings.isScrolledToBottom||(settings.isScrolledToBottom=!0,$(document).trigger("viewport/scroll/toBottom"))),settings.scrollTop<settings.documentHeight-settings.height-settings.scrollBottomOffset&&settings.isScrolledToBottom&&(settings.isScrolledToBottom=!1,$(document).trigger("viewport/scroll/fromBottom")),settings.scrollTop<settings.height&&(settings.isScrolledToFirstScreen||(settings.isScrolledToFirstScreen=!0,$(document).trigger("viewport/scroll/toFirstScreen"))),settings.scrollTop>settings.height&&settings.isScrolledToFirstScreen&&(settings.isScrolledToFirstScreen=!1,$(document).trigger("viewport/scroll/fromFirstScreen")),settings.scrollTop>settings.documentHeight-2*settings.height&&(settings.isScrolledToLastScreen||(settings.isScrolledToLastScreen=!0,$(document).trigger("viewport/scroll/toLastScreen"))),settings.scrollTop<settings.documentHeight-2*settings.height&&settings.isScrolledToLastScreen&&(settings.isScrolledToLastScreen=!1,$(document).trigger("viewport/scroll/fromLastScreen"))};return{init:function(){init()},scrollTo:function(target,offset,animate){((target,offset,animate)=>{Debug.log("viewport.scrollTo()"),Debug.log(target);var top="number"==typeof target?target:0,target=("string"==typeof target&&0<$("#"+target).length&&(top=parseInt($("#"+target).offset().top)),"object"==typeof target&&0<target.length&&(top=parseInt(target.offset().top)),top+=offset||settings.scrollToOffset,Math.floor(Math.abs(top-$(window).scrollTop()))),offset=Math.floor(target/settings.scrollToSpeed);animate?$("html, body").animate({scrollTop:top},offset):settings.element.scrollTop(top)})(target,offset,animate)},getWidth:function(){return settings.width},getHeight:function(){return settings.height},getScrollTop:function(){return settings.scrollTop},getScrollFactor:function(){return settings.scrollFactor}}})()),Sequencer=($(document).ready(function(){Viewport.init()}),(()=>{function init(){Debug.log("Sequencer.init()"),settings.customSamples={},Debug.log("Sequencer.bindEventHandlers()"),$(document).on("sequencer/loaded",function(){Debug.log("All samples are loaded"),settings.isLoaded=!0}).on("keydown",function(event){var key=event.which;16===event.which&&(settings.isShiftDown=!0,event.preventDefault(),toggleMetronome()),settings.isKeyDown||settings.isShiftDown||(settings.isKeyDown=!0,void 0!==settings.keyboardKeys[key]&&(event.preventDefault(),playSample(settings.keyboardKeys[key]),settings.isRecording)&&addSequenceItem(settings.keyboardKeys[key]),32===key&&(event.preventDefault(),togglePlayback()),88===key&&(event.preventDefault(),clearSequence()))}).on("keyup",function(event){settings.isKeyDown=!1,16===event.which&&(settings.isShiftDown=!1)}).on("ui/clickButton",function(event,data){var sample;void 0!==data.sample&&(sample=data.sample,playSample(sample),settings.isRecording)&&addSequenceItem(sample),data.action&&("play"===(sample=data.action)&&togglePlayback(),"clear"===sample&&clearSequence(),"metronome"===sample)&&toggleMetronome()}).on("url/init",function(event,data){data=data.hash;data?loadSequence(data):setTimeout(function(){buildDemoSequence()},0)}).on("sequencer/changeSequence",function(){saveSequence()}).on("history/undo",function(event,data){data.id&&removeSequenceItem(data.step,data.sample,data.division,data.id)}),StartAudioContext(Tone.context,$(selector.buttonStart)).then(function(){setTimeout(function(){Tone.Transport.start("+0.1")},500)}),initSampler(),settings.sampler.toMaster(),Debug.log("Sequencer.initPlayback()"),clearSequence(),Tone.Transport.bpm.value=settings.bpm,settings.events=[];for(var i=0;i<settings.division;i++)settings.events.push(i);settings.loop=new Tone.Sequence(function(time,step){settings.timeBetweenSteps=time-settings.timeLastStep,settings.lastStep=step,settings.timeLastStep=time,settings.isMetronoming&&(0===step&&playMetronome(!0),step===settings.division/4*1&&playMetronome(),step===settings.division/4*2&&playMetronome(),step===settings.division/4*3)&&playMetronome();for(var i=0;i<Object.keys(settings.defaultSamples[808]).length;i++)1===settings.sequence[i][step]&&(playSample(i),$(document).trigger("sequencer/playStep",[{step:step}])),2===settings.sequence[i][step]&&(settings.sequence[i][step]=1);$(document).trigger("sequencer/step",[{step:step}])},settings.events,settings.division+"n"),Tone.Transport.start("+0.1"),Debug.log("Sequencer.initMetronome()"),settings.metronome=(new Tone.Synth).toMaster(),startPlayback()}function initSampler(){Debug.log("Sequencer.initSampler()"),settings.sampler&&settings.sampler.dispose(),settings.activePlaybackConfiguration=[];for(var samplesForToneMultiPlayer={},i=0;i<Object.keys(settings.defaultSamples[808]).length;i++){var currentSrc=settings.defaultSamples[808][i].src,currentGain=settings.defaultSamples[808][i].gain;settings.customSamples[i]&&settings.customSamples[i].src&&(currentSrc=settings.customSamples[i].src,currentGain=settings.customSamples[i].gain),samplesForToneMultiPlayer[i]=currentSrc,settings.activePlaybackConfiguration[i]={src:currentSrc,gain:currentGain}}settings.sampler=new Tone.MultiPlayer(samplesForToneMultiPlayer,function(){$(document).trigger("sequencer/loaded")})}var settings={keyboardKeys:{67:0,86:1,66:2,78:3,77:4},iskeyDown:!1,isShiftDown:!1,defaultSamples:{808:{0:{src:"dist/samples/808/mp3/kick--21.mp3",gain:.9},1:{src:"dist/samples/808/mp3/clap.mp3",gain:.95},2:{src:"dist/samples/808/mp3/hi-hat--10.mp3",gain:.75},3:{src:"dist/samples/808/mp3/snare.mp3",gain:.95},4:{src:"dist/samples/808/mp3/tom--8.mp3",gain:.95}}},customSamples:{},activePlaybackConfiguration:[],bpm:108,division:16,isPlaying:!1,isRecording:!0,isLoaded:!1,isMetronoming:!1,sequence:[],lastStep:0,timeLastStep:0,timeBetweenSteps:0,analyserValue:0},selector={buttonStart:'[data-sequencer-role="buttonStart"]'},playSample=function(i,time){Debug.log("Sequencer.playSample()",i),settings.isLoaded&&settings.activePlaybackConfiguration[i]&&(settings.sampler.start(i,time,0,"1n",0,settings.activePlaybackConfiguration[i].gain),$(document).trigger("sequencer/playSample",[{sample:i}]))},startPlayback=function(){Debug.log("Sequencer.startPlayback()"),settings.isPlaying=!0,$(document).trigger("sequencer/startPlayback"),settings.loop.start()},stopPlayback=function(){Debug.log("Sequencer.stopPlayback()"),settings.isPlaying=!1,$(document).trigger("sequencer/stopPlayback"),settings.loop.stop()},togglePlayback=function(){(settings.isPlaying?stopPlayback:startPlayback)()},addSequenceItem=function(i,step){var pending;Debug.log("Sequencer.addSequenceItem()",i,step),settings.isPlaying&&settings.isRecording&&(step||(step=Math.round(settings.division*settings.loop.progress))>=settings.division&&(step=0),Debug.log("step",step),pending=settings.division*settings.loop.progress<step,settings.sequence[i][step]||(settings.sequence[i][step]=pending?2:1,$(document).trigger("sequencer/changeSequence",[{sequence:settings.sequence}]),$(document).trigger("sequencer/addSequenceItem",[{step:step,sample:i,division:settings.division,id:Date.now()}])))},removeSequenceItem=function(step,sample,division,id){Debug.log("Sequencer.removeSequenceItem()",step,sample,division,id),settings.sequence[sample][step]&&(settings.sequence[sample][step]=0,$(document).trigger("sequencer/changeSequence",[{sequence:settings.sequence}]),$(document).trigger("sequencer/removeSequenceItem",[{step:step,sample:sample,division:settings.division}]))},saveSequence=function(){Debug.log("Sequencer.saveSequence()");for(var data="",data=[],i=0;i<settings.division;i++)data.push([]);for(i=0;i<settings.sequence.length;i++)for(var j=0;j<settings.sequence[i].length;j++)settings.sequence[i][j]&&data[j].push(i);for(var string="",i=0;i<data.length;i++)0<data[i].length&&(string=(string+=String.fromCharCode(i+65))+data[i].join(""));Debug.log(string),$(document).trigger("sequencer/saveSequence",[{data:string}])},loadSequence=function(string){Debug.log("Sequencer.loadSequence()",string);var matches=string.match(/[A-Za-z][0-9]+/g);if(matches)for(var i=0;i<matches.length;i++){var match=matches[i],step=match[0].charCodeAt(0)-65;if(0<(samples=match.substr(1,match.length)).length)for(var samples=samples.split(""),j=0;j<samples.length;j++)addSequenceItem(samples[j],step)}},clearSequence=function(){Debug.log("Sequencer.clearSequence()");for(var numTracks=Object.keys(settings.defaultSamples[808]).length,i=0;i<numTracks;i++){for(var track=[],j=0;j<settings.division;j++)track[j]=0;settings.sequence[i]=track}$(document).trigger("sequencer/clearSequence"),$(document).trigger("sequencer/changeSequence")},buildDemoSequence=function(){Debug.log("Sequencer.buildDemoSequence()"),settings.sequence[0][0]=1,$(document).trigger("sequencer/addSequenceItem",[{step:0,sample:0,division:settings.division}])},toggleMetronome=function(){settings.isMetronoming=!settings.isMetronoming,$(document).trigger("sequencer/toggleMetronome",[{state:settings.isMetronoming}])},playMetronome=function(high){settings.metronome.triggerAttackRelease(high?"C5":"C4","16n","+0.05",.8)};return{init:function(){init()},isReady:function(){return!!settings.isLoaded},getProgress:function(){return!!settings.loop&&settings.loop.progress},getSequence:function(){return settings.sequence},getDivision:function(){return settings.division},setBpm:function(newBpm){(newBpm=>{Debug.log("Sequencer.setBpm()",newBpm),settings.bpm=newBpm,Tone.Transport.bpm.value=newBpm})(newBpm)},getBpm:function(){return settings.bpm},loadCustomSamples:function(newSampleData){(newSampleData=>{Debug.log("Sequencer.loadCustomSamples()",newSampleData);var sampleIndex=Object.keys(newSampleData)[0],newSampleData=newSampleData[sampleIndex];void 0!==sampleIndex&&newSampleData&&(settings.customSamples[sampleIndex]=newSampleData,$(document).trigger("sequencer/customSampleLoaded"))})(newSampleData)},revertToDefaultSamples:function(){Debug.log("Sequencer.revertToDefaultSamples()"),settings.customSamples={},initSampler()},initSampler:function(){initSampler()}}})()),Timeline=($(document).ready(function(){Sequencer.init()}),(()=>{function init(){for(var key in Debug.log("Timeline.init()"),$(document).on("viewport/loop",function(){onLoop()}).on("viewport/resize/finish",function(){onResize()}).on("timeline/loaded",function(){settings.isLoaded=!0,resize(),run()}).on("sequencer/addSequenceItem",function(event,data){try{void 0!==Debug&&"function"==typeof Debug.log&&Debug.log("Timeline: sequencer/addSequenceItem event. Step: "+(data?String(data.step):"N/A")+", Sample: "+(data?String(data.sample):"N/A"));var waiter=setInterval(function(){try{var errDataMsg;settings.isLoaded&&(clearInterval(waiter),data&&void 0!==data.step&&void 0!==data.sample&&void 0!==data.division&&void 0!==data.id?addNote(data.step,data.sample,data.division,data.id):(errDataMsg="Timeline: sequencer/addSequenceItem event triggered with null, undefined, or incomplete data object.",(void 0!==Debug&&"function"==typeof Debug.log?Debug:console).log(errDataMsg)))}catch(e_interval){console.error("Error in timeline sequencer/addSequenceItem interval callback:",e_interval)}},50)}catch(e_event){console.error("Error in timeline sequencer/addSequenceItem event handler:",e_event)}}).on("sequencer/playStep",function(event,data){playNote(data.step)}).on("sequencer/clearSequence",function(event,data){clearTimeline()}).on("history/undo",function(event,data){data.id&&removeNote(data.id)}),settings.svg.timeline=Snap(512,512).attr("id",settings.selector.timeline.replace("#","")),settings.svg.placeholder=Snap(512,512).attr("id",settings.selector.placeholder.replace("#","")),settings.layer)settings.layer.hasOwnProperty(key)&&addLayer(settings.layer[key],"timeline");for(var key in settings.layerNotes)settings.layerNotes.hasOwnProperty(key)&&addLayer(settings.layerNotes[key],"placeholder");$(document).trigger("timeline/init"),$("html").addClass("initiated--timeline")}var settings={selector:{wrapper:".timeline-wrapper",timeline:"#timeline",placeholder:"#placeholder",note:".timeline-note"},layer:{track:"timeline--track",runner:"timeline--runner"},layerNotes:{0:"timeline--note-0",1:"timeline--note-1",2:"timeline--note-2",3:"timeline--note-3",4:"timeline--note-4"},notes:[],svg:{},svgLoaded:0,isLoaded:!1,zIndex:0,zIndexStep:100},onResize=function(){resize()},onLoop=function(){run()},addLayer=function(filename,target){settings.zIndex=settings.zIndex+settings.zIndexStep;var index=settings.zIndex;Snap.load("dist/img/"+filename+".svg",function(svg){svg=svg.select("g");if(svg){var indexMax=0,groups=settings.svg[target].selectAll("g");$.each(groups,function(){var g=$(this),g=parseInt(g[0].attr("data-index"));indexMax=indexMax<g?g:indexMax}),svg.attr({"data-index":index}),indexMax<=index?svg.appendTo(settings.svg[target]):svg.prependTo(settings.svg[target]),$(settings.selector[target]).appendTo($(settings.selector.wrapper))}else if(groups="Timeline.addLayer: Failed to find <g> in loaded SVG: "+String(filename)+".svg. The loaded svg object might be invalid or empty.",void 0!==Debug&&"function"==typeof Debug.error)try{Debug.error(groups)}catch(e){console.error("Error in Debug.error itself (Timeline.addLayer):",e,"Original message:",groups)}else if(void 0!==Debug&&"function"==typeof Debug.log)try{Debug.log("ERROR: "+groups)}catch(e){console.error("Error in Debug.log itself (Timeline.addLayer):",e,"Original message:","ERROR: "+groups)}else console.error(groups);settings.svgLoaded=settings.svgLoaded+1,settings.svgLoaded===Object.keys(settings.layer).length+Object.keys(settings.layerNotes).length&&$(document).trigger("timeline/loaded")})},resize=function(){Debug.log("Timeline.resize()"),settings.size=$(settings.selector.wrapper).width(),settings.scaleFactor=settings.size/512,$(settings.selector.timeline+", "+settings.selector.placeholder).css({transform:"scale( "+settings.scaleFactor+", "+settings.scaleFactor+" )"}),settings.svg.timeline.selectAll("path").attr({strokeWidth:1/settings.scaleFactor}),settings.svg.placeholder.selectAll("path").attr({strokeWidth:1/settings.scaleFactor})},run=function(){var runner=$("#"+settings.layer.runner),progress=Sequencer.getProgress();TweenLite.to(runner,0,{transformOrigin:"50% 50%",rotation:360*progress,ease:Linear.easeNone})},addNote=function(step,sample,division,id){Debug.log("Timeline.addNote()",step,sample,division,id);var noteSelector="."+settings.layerNotes[sample];if(!(layer=settings.svg.placeholder.select(noteSelector))){noteSelector="Timeline.addNote: DIAGNOSIS: Layer for sample "+String(sample)+' (selector "'+String(noteSelector)+'") was NOT found in placeholder SVG.';if(void 0!==Debug&&"function"==typeof Debug.log)try{Debug.log(noteSelector)}catch(e){console.error("Error in Debug.log itself (Timeline.addNote):",e,"Original message:",noteSelector)}else console.log(noteSelector)}if(layer){var layer=layer.clone(),noteSelector=(settings.notes.push({step:step,sample:sample,layer:layer,id:id}),step/division*360);switch(layer.attr("data-id",id).prependTo(settings.svg.timeline),TweenLite.to(layer.node,0,{transformOrigin:"50% 50%",rotation:noteSelector,ease:Linear.easeNone}),sample){case 0:animateLine(layer.select(".shape"),.5,1);break;case 1:animateLine(layer.select(".shape"),.5,-1);break;case 2:animateLine(layer.select(".shape"),.25,-1);break;case 3:animateLine(layer.select(".shape"),.5,-1)}}},removeNote=function(id){Debug.log("Timeline.removeNote()",id);var layer=$(settings.selector.timeline).find('[data-id="'+id+'"]');layer&&layer.remove();for(var i=0;i<settings.notes.length;i++)settings.notes[i].id==id&&settings.notes.splice(i,1)},clearTimeline=function(){Debug.log("Timeline.clearTimeline()"),settings.notes=[],settings.svg.timeline.selectAll(".timeline--note").remove()},animateLine=function(path,duration,direction){var length;path&&(length=path.getTotalLength(),$(path.node).css({strokeDasharray:length,strokeDashoffset:length*direction}),TweenLite.to(path.node,duration,{strokeDashoffset:0,ease:Power4.easeInOut}))},playNote=function(step){Debug.log("Sequencer.playNote()",step);for(var i=0;i<settings.notes.length;i++)settings.notes[i].step===step&&(new TimelineLite).fromTo(settings.notes[i].layer.select(".shape").node,.5,{transformOrigin:"50% 50%",scaleX:1.5,scaleY:1.5,strokeOpacity:.75,ease:Elastic.easeOut.config(1,.3)},{transformOrigin:"50% 50%",scaleX:1,scaleY:1,strokeOpacity:1,ease:Elastic.easeOut.config(1,.3)})};return{init:function(){init()},isReady:function(){return!!settings.isLoaded}}})()),Url=($(document).ready(function(){Timeline.init()}),(()=>{function init(){Debug.log("url.init()"),onHashchange(),$(window).on("hashchange",function(){settings.isChanging||(Debug.log("hashchange"),onHashchange())}),$(document).on("sequencer/clearSequence",function(event,data){set("")}),$(document).trigger("url/init",[{hash:settings.hash}])}var settings={hash:"",isChanging:!1},onHashchange=function(){var hash=location.hash;"#"===hash.substr(0,1)&&(settings.hash=hash.substr(1,hash.length)),settings.hash&&$(document).trigger("url/change",[{hash:settings.hash}])},set=function(hash){settings.isChanging=!0,location.hash=hash,setTimeout(function(){settings.isChanging=!1},500)};return{init:function(){init()}}})()),Intro=($(document).ready(function(){Url.init()}),(()=>{function init(){Debug.log("Intro.init()"),settings.element.title=$(settings.selector.title),settings.step=settings.duration/settings.steps,$(document).on("viewport/loop",function(){onLoop()}),$(document).trigger("intro/init"),Debug.log("Intro.start()"),settings.startTime=Date.now(),settings.timer=setInterval(function(){settings.isVisible&&(settings.current<settings.steps?countUp:stop)()},settings.step),$("html").addClass("visible--intro"),$(document).trigger("intro/start")}var settings={selector:{intro:".intro",title:".intro-title"},element:{},isVisible:!0,duration:2e3,startTime:null,time:null,steps:108,current:0},onLoop=function(){},stop=function(){Debug.log("Intro.stop()"),settings.isVisible=!1,clearInterval(settings.timer),waitForReady(function(){$(document).trigger("intro/stop"),setTimeout(function(){$(document).one("transitionend",settings.selector.intro,function(){$(settings.selector.intro).remove()}),$("html").removeClass("visible--intro")},1e3)})},countUp=function(){settings.current=settings.current+1,settings.element.title.text(settings.current)},waitForReady=function(callback){Sequencer&&Timeline&&(settings.waiter=setInterval(function(){Debug.log("waiting..."),Sequencer.isReady()&&Timeline.isReady()&&(clearInterval(settings.waiter),callback())},100))};return{init:function(){init()}}})()),Title=($(document).ready(function(){Intro.init()}),(()=>{function init(){Debug.log("title.init()"),settings.element.title=$(settings.selector.title),settings.text.title=settings.element.title.text(),$(document).on("sequencer/step",function(event,data){onStep(data.step)})}var settings={selector:{title:"title"},element:{},text:{title:"",runner:"●",spacer:"   "}},onStep=function(step){Debug.log("title.onStep()");for(var text="",i=0;i<Sequencer.getDivision();i++)text+=i===step?settings.text.runner:"·";text+=settings.text.spacer+settings.text.title,set(text)},set=function(text){settings.element.title.text(text)};return{init:function(){init()}}})()),History=($(document).ready(function(){768<Viewport.getWidth()&&Title.init()}),(()=>{function init(){Debug.log("History.init()"),$(document).on("sequencer/addSequenceItem",function(event,data){addItem(data.step,data.sample,data.division,data.id)}).on("ui/clickButton",function(event,data){"undo"===data.action&&undo()}).on("keydown",function(event){state.keyDown||(state.keyDown=!0,90===event.which&&(event.preventDefault(),undo()))}).on("keyup",function(event){state.keyDown=!1}),$(document).trigger("history/init")}var settings={maxLength:32},state={keyDown:!1},history={},addItem=function(step,sample,division,id){Debug.log("History.init()",id),id&&(0<history.length&&Object.keys(history).length>settings.maxLength-1&&history.shift(),history[id]={step:step,sample:sample,division:division}),Debug.log(history)},undo=function(){var id,item;Debug.log("History.undo()"),0<Object.keys(history).length&&(id=Object.keys(history)[Object.keys(history).length-1],item=history[id],$(document).trigger("history/undo",[{step:item.step,sample:item.sample,division:item.division,id:id}]),delete history[id],Debug.log(history))};return{init:function(){init()}}})()),Recorder=($(document).ready(function(){History.init()}),(()=>{function init(){Debug.log("Recorder.init()"),Debug.log("Recorder.buildRecorder()"),Tone.Master?settings.recorder=new WebAudioRecorder(Tone.Master.output,{workerDir:"src/js/workers/"}):Debug.log("Tone.Master was not found"),settings.recorder.onComplete=function(recorder,blob){onComplete(blob)},$(document).on("ui/clickButton",function(event,data){"record"===data.action&&(state.recording?state.processing||stopRecording():state.busy||startRecording())}).on("keydown",function(event){state.keyDown||(state.keyDown=!0,82===event.which&&(event.preventDefault(),state.recording?state.processing||stopRecording():state.busy||startRecording()))}).on("keyup",function(event){state.keyDown=!1}),$(document).trigger("recorder/init")}var settings={},state={keyDown:!1,recording:!1,processing:!1,busy:!1},onComplete=function(blob){Debug.log("Recorder.onComplete()"),setTimeout(function(){saveAs(blob,"108-beat--"+Date.now()+".wav"),state.processing=!1,state.busy=!1,$(document).trigger("recorder/finish")},1e3)},startRecording=function(){Debug.log("Recorder.startRecording()"),settings.recorder.startRecording(),state.recording=!0,state.busy=!0,$(document).trigger("recorder/start")},stopRecording=function(){Debug.log("Recorder.stopRecording()"),settings.recorder.finishRecording(),state.recording=!1,state.processing=!0,$(document).trigger("recorder/stop")};return{init:function(){init()}}})());$(document).ready(function(){Recorder.init()});